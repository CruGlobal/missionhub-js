!function(){"use strict";angular.module("missionhub.api.utils",["LocalStorageModule","change-case"])}(),function(){"use strict";angular.module("missionhub.api.utils").constant("_",window._).constant("deepDiff",window.DeepDiff)}(),function(){"use strict";function n(n){function e(){return n.get("firstName")}function t(e){return n.set("firstName",e)}function r(){return n.get("lastName")}function i(e){return n.set("lastName",e)}function a(){return n.get("personId")}function u(e){return n.set("personId",e)}function o(){return n.get("profilePicture")}function s(e){return n.set("profilePicture",e)}function c(){return n.get("currentOrganization")}function l(e){return n.set("currentOrganization",e)}function f(){n.clearAll()}var d={getFirstName:e,setFirstName:t,getLastName:r,setLastName:i,getPersonId:a,setPersonId:u,getProfilePicture:o,setProfilePicture:s,getCurrentOrganization:c,setCurrentOrganization:l,clearAll:f};return d}angular.module("missionhub.api.utils").factory("userDetails",n),n.$inject=["localStorageService"]}(),function(){"use strict";function n(n,e,t){function r(){var n=new LokiIndexedAdapter("missionhub-loki");l=new e("missionhub",{autosave:!0,autosaveInterval:1e3,adapter:n}),i()}function i(){return p?t.Observable.just(l):f?f:f=t.Observable.create(function(n){l.loadDatabase({},function(){p=!0,n.onNext(l),n.onCompleted()})})}function a(n){return m[n]?t.Observable.just(m[n]):i().map(function(){var e=l.getCollection(n);return null===e&&(e=l.addCollection(n),e.ensureUniqueIndex("id")),m[n]=e,e})}function u(n,e){return a(n).map(function(n){return n.by("id",e)})}function o(n,e,t){return a(n).map(function(n){var r=n.chain();return e&&(r=r.find(e)),t&&(r=r.simplesort(t.property,t.descending)),r.data()})}function s(n,e){return c(n,e)}function c(e,t){return a(e).map(function(e){var r,i=e.by("id",t.id);return i?(i=n.merge(i,t),r=e.update(i)):r=e.insert(t),r})}var l,f,d={get:u,search:o,save:s},p=!1,m=[];return r(),d}angular.module("missionhub.api.utils").factory("lokiDB",n),n.$inject=["_","Loki","rx"]}(),function(){"use strict";function n(n,e,t){function r(e,t){l=t;var r=a(e.included);return n.isArray(e.data)?n(e.data).map(function(n){return u(n,r)}).value():u(e.data,r)}function i(e){var t={id:e.id,type:e.typeJsonapi};return t.attributes=n(e).omit("id","typeJsonapi").mapKeys(function(n,e){return c(e)}).value(),{data:t}}function a(e){return n(e).groupBy(function(n){return n.type}).mapValues(function(e){return n(e).mapKeys(function(n){return n.id}).mapValues(u).value()}).value()}function u(e,t){var r={};r.id=e.id,r.typeJsonapi=s(e.type);var i=n.mapKeys(e.attributes,function(n,e){return s(e)});if(r=n.merge(r,i),n.isObject(t)&&!n.isEmpty(t)){var a=n.mapKeys(e.relationships,function(n,e){return s(e)}),u=o(a,t);r=n.merge(r,u)}return r}function o(t,r){return n(t).mapValues(function(t){return n(t.data).map(function(n){return void 0===r[n.type]||void 0===r[n.type][n.id]?void e.error("Deserializing response from",l+": Could not load data for relationship of type",n.type,"and id",n.id):r[n.type][n.id]}).value()}).value()}function s(n){return t.camelCase(n)}function c(n){return t.snakeCase(n).replace(/(_)(\d)/g,"$2")}var l,f={deserialize:r,serialize:i,_indexIncludes:a,_flattenData:u,_findRelationships:o,_snakeToCamelCase:s,_camelToSnakeCase:c};return f}angular.module("missionhub.api.utils").factory("jsonapi",n),n.$inject=["_","$log","changeCase"]}(),function(){"use strict";function n(n,e,t,r,i,a,u){function o(n,e){var a=r.Observable.fromPromise(i.currentRestangular().one(n,e).get()).flatMap(function(e){return t.save(n,e)});return t.get(n,e).concat(a)}function s(n,e,a){var u=r.Observable.fromPromise(i.currentRestangular().all(n).getList()).flatMap(function(n){return n}).flatMap(function(e){return t.save(n,e)}).toArray();return t.search(n,e,a).concat(u.flatMap(function(){return t.search(n,e,a)}))}function c(n,e){return r.Observable.fromPromise(i.currentRestangular().one(n,e.id).patch(e)).flatMap(function(e){return console.log("%cresponse from save","color: green; font-weight: bold",e),l(n,e)})}function l(n,e){return t.save(n,e)}var f={get:o,search:s,save:c};return r.Observable.prototype.bind=function(t,i,o){var s,l=!1;e.set(t,i,{});var f=a(t,i,!0).filter(function(){return l?(l=!1,!1):!0}).map(function(n){return s=n.newValue,u.diff(n.oldValue,n.newValue,function(n,t){return"$"===t[0]||e.includes(["getRestangularUrl","getRequestedUrl","addRestangularMethod","clone","withHttpConfig","plain","one","all","several","oneUrl","allUrl","get","getList","put","post","remove","head","trace","options","patch","save","customOperation","doPUT","customPUT","doPOST","customPOST","doGET","customGET","doDELETE","customDELETE","customGETLIST","doGETLIST","meta","interactions","messages"],t)})}).filter(function(n){return void 0!==n}).flatMap(function(n){return r.Observable.from(n)}),d=f.window(f.debounce(500)).flatMap(function(t){return t.reduce(function(t,r){var i=r.path.length>1&&e.has(e.get(s,e.dropRight(r.path)),"typeJsonapi");switch(r.kind){case"N":case"E":i?console.log("construct changed obj to send to",r.path[0]+"/"+e.get(s,e.dropRight(r.path)).id):e.set(t,r.path,r.rhs);break;case"D":i?console.log("send DELETE to",r.path[0]+"/"+r.rhs.id):e.set(t,r.path,null);break;default:n.error("Change type not handled",r)}return t},{}).filter(function(n){return!e.isEmpty(n)}).flatMap(function(n){return e.merge(n,{id:s.id,typeJsonapi:s.typeJsonapi}),c(o,n)})});return this.merge(d).safeApply(t,function(n){console.log("%cApplying data to scope","color: purple",n),l=!0,e.set(t,i,n)})},f}angular.module("missionhub.api.utils").factory("datastore",n),n.$inject=["$log","_","lokiDB","rx","organizations","observeOnScope","deepDiff"]}(),function(){"use strict";angular.module("missionhub.api.filters",[])}(),function(){"use strict";function n(){return function(n){if(!n)return"";var e=n.toString().trim().replace(/^\+/,"");if(e.match(/[^0-9]/))return n;var t,r,i;switch(e.length){case 10:t=1,r=e.slice(0,3),i=e.slice(3);break;case 11:t=e[0],r=e.slice(1,4),i=e.slice(4);break;case 12:t=e.slice(0,3),r=e.slice(3,5),i=e.slice(5);break;default:return n}return 1===t&&(t=""),i=i.slice(0,3)+"-"+i.slice(3),(t+" ("+r+") "+i).trim()}}angular.module("missionhub.api.filters").filter("tel",n)}(),function(){"use strict";function n(n,e){return function(t){if(!t)return"";var r=n.currentOrg(),i=e.find(r.surveys,{id:t.survey_id});return e.result(i,"title","")}}angular.module("missionhub.api.filters").filter("surveyName",n),n.$inject=["api","lodash"]}(),function(){"use strict";function n(){return function(n){if(!n||!n.phone_numbers||0===n.phone_numbers.length)return"";for(var e=0;e<n.phone_numbers.length;){if(n.phone_numbers[e].primary)return n.phone_numbers[e].number;e++}return n.phone_numbers[0].number}}angular.module("missionhub.api.filters").filter("personPrimaryPhone",n)}(),function(){"use strict";function n(){return function(n){return n&&n.first_name?n.first_name+" "+n.last_name:""}}angular.module("missionhub.api.filters").filter("personFullname",n)}(),function(){"use strict";function n(){return function(n,e){if(e=e||40,!n||!n.first_name)return"";if(n.picture)return n.picture+"?width="+e+"&height="+e;for(var t="444444",r=0,i=0;r<n.first_name.length;i=n.first_name.charCodeAt(r++)+((i<<5)-i));for(var r=0,t="";3>r;t+=("00"+(i>>8*r++&255).toString(16)).slice(-2));return"https://avatars.discourse.org/letter/"+n.first_name.slice(0,1)+"/"+t+"/"+e+".png"}}angular.module("missionhub.api.filters").filter("personAvatar",n)}(),function(){"use strict";function n(){return function(n){return n?n.initiators[0]?n.initiators[0]:n.creator?n.creator:{}:{}}}angular.module("missionhub.api.filters").filter("interactionPrimaryInitiator",n)}(),function(){"use strict";function n(){return function(n){var e="http://maps.google.com/maps?q=";return n.address1&&(e+=n.address1+"+"),n.address2&&(e+=n.address2+"+"),n.city&&(e+=n.city+",+"),n.state&&(e+=n.state+"+"),n.country&&(e+=n.country),e.lastIndexOf("+")===e.length-1&&(e=e.slice(0,-1)),e}}angular.module("missionhub.api.filters").filter("googleMapsAddress",n)}(),function(){"use strict";function n(){return function(n){return"background-image: url("+n+")"}}angular.module("missionhub.api.filters").filter("backgroundStyle",n)}(),function(){"use strict";angular.module("missionhub.api",["restangular","lokijs","rx","missionhub.api.cache","missionhub.api.filters","missionhub.api.utils"])}(),function(){"use strict";function n(n,e,t){function r(n,e){return t.search("people",n,e)}function i(n){return t.get("people",n)}function a(n){return t.save("people",n)}var u={all:r,get:i,save:a};return u}angular.module("missionhub.api").factory("people",n),n.$inject=["organizations","userDetails","datastore"]}(),function(){"use strict";function n(n,e){function t(){return u.allRestangular().getList()}function r(){return u.currentRestangular().get()}function i(){return n.all("organizations")}function a(){return n.one("organizations",e.getCurrentOrganization().id)}var u={all:t,current:r,allRestangular:i,currentRestangular:a};return u}angular.module("missionhub.api").factory("organizations",n),n.$inject=["Restangular","userDetails"]}(),function(){"use strict";function n(n,e,t,r){function i(){return r.all().then(function(n){return t.map(n,function(n){return{name:n.full_name}})})}function a(){return e(function(n){n([{name:"To retrieve from server"}])})}function u(){return e(function(n){n([{name:"To retrieve from server"}])})}function o(){return e(function(n){n([{id:"uncontacted",name:"Uncontacted"},{id:"attempted_contact",name:"Attempted Contact"},{id:"contacted",name:"Contacted"},{id:"completed",name:"Completed"},{id:"do_not_contact",name:"Do Not Contact"}])})}function s(){return e(function(n){n([{id:"admin",name:"Admin"},{id:"user",name:"User"},{id:"guest",name:"Guest"},{id:"none",name:"None"}])})}function c(){return e(function(n){n([{id:"male",name:"Male"},{id:"female",name:"Female"}])})}function l(){return e(function(n){n([{id:"yes",name:"Yes"},{id:"no",name:"No"}])})}function f(){return e(function(n){n([{name:"Survey 1"},{name:"Survey 2"}])})}function d(n){return e(function(e){e([{name:"Question 1 - "+n},{name:"Question 1 - "+n}])})}function p(n,t){return e(function(e){e([{name:"Answer 1 - "+n+" - "+t},{name:"Answer 1 - "+n+" - "+t}])})}var m={assignedTo:i,initiators:i,interactions:a,groups:u,status:o,permissions:s,gender:c,faculty:l,surveys:f,questions:d,answers:p};return m}angular.module("missionhub.api").factory("filters",n),n.$inject=["Restangular","$q","_","people"]}(),function(){"use strict";angular.module("missionhub.api.cache",[])}(),function(){"use strict";function n(){function n(n){return n.id?(e[n.id]=e[n.id]||{},angular.merge(e[n.id],n),!0):e[n]}var e={};return{person:n}}angular.module("missionhub.api.cache").factory("personCache",n)}(),function(){"use strict";function n(){function n(n){return n.id?(e[n.id]=e[n.id]||{},angular.merge(e[n.id],n),!0):e[n]}var e={};return{organization:n}}angular.module("missionhub.api.cache").factory("organizationCache",n)}(),function(){"use strict";function n(){function n(n){return n&&n.length?0===n.length?0===e.length:(e=[],angular.merge(e,n),!0):angular.extend([],e)}var e=[];return{list:n}}angular.module("missionhub.api.cache").factory("organizationListCache",n)}(),function(){"use strict";function n(n,e){function t(n,e,t,i,a){function u(){n.addResponseInterceptor(function(n,t,r,i){return e.deserialize(n,i)}),n.addRequestInterceptor(function(n,t){return"patch"===t?e.serialize(n):n})}var o={baseUrl:r.baseUrl,people:{all:t.all,current:t.current,get:t.get,save:t.save},organizations:{all:i.all,current:i.current},filters:{possibilities:{assignedTo:a.assignedTo,initiators:a.initiators,interactions:a.interactions,groups:a.groups,status:a.status,permissions:a.permissions,gender:a.gender,faculty:a.faculty,surveys:a.surveys,questions:a.questions,answers:a.answers}}};return u(),o}var r={$get:t};return Object.defineProperties(r,{baseUrl:{get:function(){return n.baseUrl},set:function(t){n.baseUrl=t,e.setBaseUrl(t)}}}),t.$inject=["Restangular","jsonapi","people","organizations","filters"],r}angular.module("missionhub.api").provider("api",n),n.$inject=["apiConfig","RestangularProvider"]}(),function(){"use strict";angular.module("missionhub.api").constant("_",window._).constant("apiConfig",{baseUrl:"/"})}(),function(){"use strict";function n(n){n.setPrefix("mh.user")}angular.module("missionhub.api").config(n),n.$inject=["localStorageServiceProvider"]}();