!function(){"use strict";angular.module("missionhub.api",["missionhub.api.cache","missionhub.api.filters","missionhub.api.utils"])}(),function(){"use strict";function e(e,n){function r(){return personCache.person(u.currentPersonId)}function t(){var n=["all_organization_and_children","all_organizational_permissions","user","organizational_permission","permission","organizational_labels","label","interactions","email_addresses","phone_numbers","addresses"],r=$q.defer();return i({id:"me",include:n.join()}).then(function(e){var n=e.person;u.currentPersonId=n.id,personCache.person(n),organizationListCache.list(n.all_organization_and_children),currentOrg({id:n.user.primary_organization_id}).then(function(){r.resolve(n)},function(e){r.reject(e)})},function(n){e.error("Requesting your data failed due to: "+n),r.reject(n)}),r.promise}function i(e){var r=n.mhResource("people",e);return r.then(function(e){angular.forEach(e.people,function(e){personCache.person(e)})}),r}function o(e){var n=["organizational_permission","permission","organizational_labels","label","email_addresses","phone_numbers","addresses"];return i({id:e,include:n.join()})}function s(e){var n=["answer_sheets","answers"];return i({id:e,include:n.join()})}function a(e){var n=["organizational_permission","permission","organizational_labels","label","email_addresses","phone_numbers","addresses","answer_sheets","answers","interactions","interaction_type"];return i({id:e,include:n.join()})}var u={},c={currentPerson:r,getMe:t,getPeople:i,getPersonWithInfo:o,getPersonWithSurveyAnswers:s,getPersonWithEverything:a};return c}angular.module("missionhub.api").factory("people",e),e.$inject=["$log","mhResource"]}(),function(){"use strict";function e(e,n,r,t){function i(t){if(!t)return r.organization(s.currentOrgId);var i=["admins","users","surveys","labels","questions","interaction_types"];return o({id:t.id,include:i.join(),organization_id:t.id}).then(function(n){var t=n.organization;r.organization(t),s.currentOrgId!==t.id&&(s.currentOrgId=t.id,e.$broadcast("current-org-updated",t))},function(e){n.error("Organization change failed because: "+e.statusText)})}function o(e){return t.mhResource("organizations",e)}var s={},a={currentOrg:i,getOrganizations:o};return a}angular.module("missionhub.api").factory("organizations",e),e.$inject=["$rootScope","$log","organizationCache","mhResource"]}(),function(){"use strict";function e(e){function n(n){return e.mhResource("interactions",n)}function r(e){var r={"filters[people_ids]":e},t=["initiators","interaction_type","receiver","creator","last_updater"],i=angular.extend({include:t.join()},r);return n(i)}var t={getInteractions:n,getInteractionsForPerson:r};return t}angular.module("missionhub.api").factory("interactions",e),e.$inject=["mhResource"]}(),function(){"use strict";angular.module("missionhub.api.utils",["ngResource","LocalStorageModule"])}(),function(){"use strict";function e(e){function n(){return e.get("firstName")}function r(n){return e.set("firstName",n)}function t(){return e.get("lastName")}function i(n){return e.set("lastName",n)}function o(){return e.get("personId")}function s(n){return e.set("personId",n)}function a(){return e.get("profilePicture")}function u(n){return e.set("profilePicture",n)}function c(){return e.get("currentOrganization")}function l(n){return e.set("currentOrganization",n)}function f(){e.clearAll()}var g={getFirstName:n,setFirstName:r,getLastName:t,setLastName:i,getPersonId:o,setPersonId:s,getProfilePicture:a,setProfilePicture:u,getCurrentOrganization:c,setCurrentOrganization:l,clearAll:f};return g}angular.module("missionhub.api.utils").factory("userDetails",e),e.$inject=["localStorageService"]}(),function(){"use strict";function e(e,n){function r(e){o.baseUrl=e}function t(n,r){return o.currentOrgId&&"organizations"!==n&&angular.extend(r,{organization_id:o.currentOrgId}),e(o.baseUrl+n+"/:id",{id:"@id",facebook_token:i()}).get(r).$promise}function i(){return n.token()}var o={},s={mhResource:t,setBaseUrl:r};return s}angular.module("missionhub.api.utils").factory("mhResource",e),e.$inject=["$resource","customLoginDetails"]}(),function(){"use strict";function e(e){function n(n){return void 0===n?e.localStorage.getItem(r):void(n?e.localStorage.setItem(r,n):e.localStorage.removeItem(r))}var r="facebook_token";return{token:n}}angular.module("missionhub.api.utils").factory("customLoginDetails",e),e.$inject=["$window"]}(),function(){"use strict";angular.module("missionhub.api.cache",[])}(),function(){"use strict";function e(){function e(e){return e.id?(n[e.id]=n[e.id]||{},angular.merge(n[e.id],e),!0):n[e]}var n={};return{person:e}}angular.module("missionhub.api.cache").factory("personCache",e)}(),function(){"use strict";function e(){function e(e){return e.id?(n[e.id]=n[e.id]||{},angular.merge(n[e.id],e),!0):n[e]}var n={};return{organization:e}}angular.module("missionhub.api.cache").factory("organizationCache",e)}(),function(){"use strict";function e(){function e(e){return e&&e.length?0===e.length?0===n.length:(n=[],angular.merge(n,e),!0):angular.extend([],n)}var n=[];return{list:e}}angular.module("missionhub.api.cache").factory("organizationListCache",e)}(),function(){"use strict";angular.module("missionhub.api.filters",[])}(),function(){"use strict";function e(){return function(e){if(!e)return"";var n=e.toString().trim().replace(/^\+/,"");if(n.match(/[^0-9]/))return e;var r,t,i;switch(n.length){case 10:r=1,t=n.slice(0,3),i=n.slice(3);break;case 11:r=n[0],t=n.slice(1,4),i=n.slice(4);break;case 12:r=n.slice(0,3),t=n.slice(3,5),i=n.slice(5);break;default:return e}return 1===r&&(r=""),i=i.slice(0,3)+"-"+i.slice(3),(r+" ("+t+") "+i).trim()}}angular.module("missionhub.api.filters").filter("tel",e)}(),function(){"use strict";function e(e,n){return function(r){if(!r)return"";var t=e.currentOrg(),i=n.find(t.surveys,{id:r.survey_id});return n.result(i,"title","")}}angular.module("missionhub.api.filters").filter("surveyName",e),e.$inject=["api","lodash"]}(),function(){"use strict";function e(){return function(e){if(!e||!e.phone_numbers||0===e.phone_numbers.length)return"";for(var n=0;n<e.phone_numbers.length;){if(e.phone_numbers[n].primary)return e.phone_numbers[n].number;n++}return e.phone_numbers[0].number}}angular.module("missionhub.api.filters").filter("personPrimaryPhone",e)}(),function(){"use strict";function e(){return function(e){return e&&e.first_name?e.first_name+" "+e.last_name:""}}angular.module("missionhub.api.filters").filter("personFullname",e)}(),function(){"use strict";function e(){return function(e,n){if(n=n||40,!e||!e.first_name)return"";if(e.picture)return e.picture+"?width="+n+"&height="+n;for(var r="444444",t=0,i=0;t<e.first_name.length;i=e.first_name.charCodeAt(t++)+((i<<5)-i));for(var t=0,r="";3>t;r+=("00"+(i>>8*t++&255).toString(16)).slice(-2));return"https://avatars.discourse.org/letter/"+e.first_name.slice(0,1)+"/"+r+"/"+n+".png"}}angular.module("missionhub.api.filters").filter("personAvatar",e)}(),function(){"use strict";function e(){return function(e){return e?e.initiators[0]?e.initiators[0]:e.creator?e.creator:{}:{}}}angular.module("missionhub.api.filters").filter("interactionPrimaryInitiator",e)}(),function(){"use strict";function e(){return function(e){var n="http://maps.google.com/maps?q=";return e.address1&&(n+=e.address1+"+"),e.address2&&(n+=e.address2+"+"),e.city&&(n+=e.city+",+"),e.state&&(n+=e.state+"+"),e.country&&(n+=e.country),n.lastIndexOf("+")===n.length-1&&(n=n.slice(0,-1)),n}}angular.module("missionhub.api.filters").filter("googleMapsAddress",e)}(),function(){"use strict";function e(){return function(e){return"background-image: url("+e+")"}}angular.module("missionhub.api.filters").filter("backgroundStyle",e)}(),function(){"use strict";function e(e){function n(e,n,t,i){function o(){e.setBaseUrl(s.baseUrl)}var s={baseUrl:r.baseUrl,currentPerson:n.currentPerson,currentOrg:t.currentOrg,people:{get:n.getPeople,getMe:n.getMe,getPersonWithEverything:n.getPersonWithEverything,getPersonWithInfo:n.getPersonWithInfo,getPersonWithSurveyAnswers:n.getPersonWithSurveyAnswers},interactions:{get:i.getInteractions,getInteractionsForPerson:i.getInteractionsForPerson},organizations:{get:t.getOrganizations}};return o(),s}var r={$get:n};return Object.defineProperties(r,{baseUrl:{get:function(){return e.baseUrl},set:function(n){e.baseUrl=n}}}),n.$inject=["mhResource","people","organizations","interactions"],r}angular.module("missionhub.api").provider("api",e),e.$inject=["apiConfig"]}(),function(){"use strict";angular.module("missionhub.api").constant("apiConfig",{baseUrl:"/"})}(),function(){"use strict";function e(e){e.setPrefix("mh.user")}angular.module("missionhub.api").config(e),e.$inject=["localStorageServiceProvider"]}();