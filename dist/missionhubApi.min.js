!function(){"use strict";angular.module("missionhub.api.utils",["LocalStorageModule","change-case","lokijs","rx","restangular","missionhub.api.config"])}(),function(){"use strict";angular.module("missionhub.api.utils").constant("_",window._).constant("deepDiff",window.DeepDiff).constant("LokiIndexedAdapter",window.LokiIndexedAdapter)}(),function(){"use strict";function e(e){function n(){return e.get("firstName")}function t(n){return e.set("firstName",n)}function r(){return e.get("lastName")}function i(n){return e.set("lastName",n)}function a(){return e.get("personId")}function u(n){return e.set("personId",n)}function o(){return e.get("profilePicture")}function s(n){return e.set("profilePicture",n)}function c(){return e.get("currentOrganization")}function l(n){return e.set("currentOrganization",n)}function f(){e.clearAll()}var p={getFirstName:n,setFirstName:t,getLastName:r,setLastName:i,getPersonId:a,setPersonId:u,getProfilePicture:o,setProfilePicture:s,getCurrentOrganization:c,setCurrentOrganization:l,clearAll:f};return p}angular.module("missionhub.api.utils").factory("userDetails",e),e.$inject=["localStorageService"]}(),function(){"use strict";function e(e){var i={$get:n,parse:t,concat:r};return i}function n(e){var n={parse:t,concat:r};return n}function t(e){if(_.isArray(e)&&(e=_.join(e,"/")),_.isString(e))return _.replace(e,"/(^/)|(/$)/g","");throw new Error("Path is not a string or array")}function r(e){return _.join(_.compact(e),"/")}angular.module("missionhub.api.utils").provider("pathUtils",e),e.$inject=["_"],n.$inject=["_"]}(),function(){"use strict";function e(e,n,t,r){function i(){var e=new t("missionhub-loki");f=new n("missionhub",{autosave:!0,autosaveInterval:1e3,adapter:e}),a()}function a(){return m?r.Observable.just(f):p?p:p=r.Observable.create(function(e){f.loadDatabase({},function(){m=!0,e.onNext(f),e.onCompleted()})})}function u(e){return g[e]?r.Observable.just(g[e]):a().map(function(){var n=f.getCollection(e);return null===n&&(n=f.addCollection(e),n.ensureUniqueIndex("id")),g[e]=n,n})}function o(e,n){return u(e).map(function(e){return e.by("id",n)})}function s(e,n,t){return u(e).map(function(e){var r=e.chain();return n&&(r=r.find(n)),t&&(r=r.simplesort(t.property,t.descending)),r.data()})}function c(e,n){return l(e,n)}function l(n,t){return u(n).map(function(n){var r,i=n.by("id",t.id);return i?(t.$loki=i.$loki,t.meta=e.create(i.meta),r=n.update(t)):r=n.insert(t),r})}var f,p,d={get:o,search:s,save:c},m=!1,g=[];return i(),d}angular.module("missionhub.api.utils").factory("lokiDB",e),e.$inject=["_","Loki","LokiIndexedAdapter","rx"]}(),function(){"use strict";function e(e,n,t){function r(n,t){l=t;var r=a(n.included);return e.isArray(n.data)?e(n.data).map(function(e){return u(e,r)}).value():u(n.data,r)}function i(n){var t={id:n.id,type:n.typeJsonapi};return t.attributes=e(n).omit("id","typeJsonapi").mapKeys(function(e,n){return c(n)}).value(),{data:t}}function a(n){return e(n).groupBy(function(e){return e.type}).mapValues(function(n){return e(n).mapKeys(function(e){return e.id}).mapValues(u).value()}).value()}function u(n,t){var r={};r.id=n.id,r.typeJsonapi=s(n.type);var i=e.mapKeys(n.attributes,function(e,n){return s(n)});if(r=e.merge(r,i),e.isObject(t)&&!e.isEmpty(t)){var a=e.mapKeys(n.relationships,function(e,n){return s(n)}),u=o(a,t);r=e.merge(r,u)}return r}function o(t,r){return e(t).mapValues(function(t){return e(t.data).map(function(e){return void 0===r[e.type]||void 0===r[e.type][e.id]?void n.error("Deserializing response from",l+": Could not load data for relationship of type",e.type,"and id",e.id):r[e.type][e.id]}).value()}).value()}function s(e){return t.camelCase(e)}function c(e){return t.snakeCase(e).replace(/(_)(\d)/g,"$2")}var l,f={deserialize:r,serialize:i,_indexIncludes:a,_flattenData:u,_findRelationships:o,_snakeToCamelCase:s,_camelToSnakeCase:c};return f}angular.module("missionhub.api.utils").factory("jsonapi",e),e.$inject=["_","$log","changeCase"]}(),function(){"use strict";function e(e,n,t,r,i,a,u,o,s){function c(e,n){return t.create(this,{observable:i.get(e,n).concat(this.getFromApiOnly(e,n).observable)})}function l(e,n){return t.create(this,{observable:a.Observable.fromPromise(this.currentRestangular().one(e,n).get()).flatMap(function(e){return m(e)})})}function f(e,n,r){var u=a.Observable.fromPromise(this.currentRestangular().all(e).getList()).tap(function(e){console.log("tap",e)}).flatMap(function(e){return console.log("flatMap",e),m(e)}).toArray();return t.create(this,{observable:i.search(e,n,r).concat(u.flatMap(function(){return i.search(e,n,r)}))})}function p(e,n){n=n||!1;var r=this;return t.create(this,{observable:a.Observable.pairs(e).flatMap(function(e){return r.save(e[0],e[1],n).observable})})}function d(e,n,i){i=i||!1;var o,s=this;return o=i?u.oneUrl("resourcePath",r.concat([s.getParentPath(),e])).post("",n):u.oneUrl("resourcePath",r.concat([s.getParentPath(),e])).patch(n),t.create(this,{observable:a.Observable.fromPromise(o).flatMap(function(t){return console.log("%cSaving","color: green; font-weight: bold",e,n,"Response",t),m(t)})})}function m(e){return e=e.plain(),e.$skipNextChangeDetection=!0,i.save(e.typeJsonapi,e)}function g(e){return t.create(this,{parentPath:r.concat([this.parentPath,r.parse(e)])})}function h(e,r,i){var u,c=this;t.set(e,r,{});var l=o(e,r,!0).filter(function(n){return n.oldValue===n.newValue||n.newValue.$skipNextChangeDetection?(t.unset(e,r+".$skipNextChangeDetection"),!1):!0}).tap(function(e){u=e.newValue}).map(function(e){return s.diff(e.oldValue,e.newValue,function(e,n){return"$"===n[0]||t.includes(["meta","interactions","messages"],n)})}).filter(function(e){return void 0!==e}).flatMap(function(e){return a.Observable.from(e)}).publish(),f=l.window(l.debounce(5e3)).flatMap(function(e){return e.reduce(function(e,r){switch(r.kind){case"N":n.warn("Handling new change type as an edit",r);case"E":var i=y(u,r.path),a=t.join(i.resourcePath,"/");e.update[a]=e.update[a]||{id:i.object.id,typeJsonapi:i.object.typeJsonapi},t.set(e.update[a],i.changesPath,r.rhs);break;case"D":var i=y(u,r.path),a=t.join(i.resourcePath,"/");n.error("Change type not handled",r,a);break;case"A":var o=t.last(r.path);switch(r.item.kind){case"N":var i=y(u,r.path,o),a=t.join(i.resourcePath,"/");e.create[a]=t.defaults({typeJsonapi:o},t.omitBy(r.item.rhs,function(e,n){return"$"===n[0]}));break;default:n.error("Unhandled array change type",r)}break;default:n.error("Unknown change type",r)}return e},{update:{},create:{}}).filter(function(e){return!t.isEmpty(e.create)||!t.isEmpty(e.update)}).flatMap(function(e){var n=Rx.Observable.empty();return console.info("%cResources to create","color: blue",e.create),t.isEmpty(e.create)||(n=n.merge(c.saveAll(e.create,!0).observable)),t.isEmpty(e.update)||(n=n.merge(c.saveAll(e.update).observable)),n.count(function(){return!0}).flatMap(function(e){return console.log("%cPerformed","color: green; font-weight: bold",e," create/update operations"),c.getFromApiOnly(u.typeJsonapi,u.id).observable})})});return l.connect(),t.create(this,{observable:this.observable.merge(f).safeApply(e,function(n){void 0!==n&&(console.log("%cLoading cache into scope","color: purple",n),t.set(e,r,n),n.$skipNextChangeDetection=!0)})})}function b(){return u.oneUrl("parentPath",this.getParentPath())}function v(){return r.concat([P,this.parentPath])}function y(e,n,r){var i,a=n,u=[];if(t.forEachRight(n,function(o,s){var c=t.slice(n,0,s+1),l=t.get(e,c);l&&(void 0!==l.id&&void 0!==l.typeJsonapi||r===o)&&(i||(i=l,a=t.slice(n,s+1)),r===o?u.unshift(r):(u.unshift(l.id),u.unshift(l.typeJsonapi)))}),i||(i=e),void 0===e.id||void 0===e.typeJsonapi)throw new Error("No object containing an id and typeJsonapi was found");return u.unshift(e.id),u.unshift(e.typeJsonapi),{object:i,changesPath:a,resourcePath:u}}var P=e.baseUrl,_={get:c,getFromApiOnly:l,search:f,save:d,saveAll:p,bind:h,parent:g,getParentPath:v,currentRestangular:b,_findParentResourceOfChange:y};return _}angular.module("missionhub.api.utils").factory("datastore",e),e.$inject=["apiConfig","$log","_","pathUtils","lokiDB","rx","Restangular","observeOnScope","deepDiff"]}(),function(){"use strict";angular.module("missionhub.api",["restangular","missionhub.api.config","missionhub.api.cache","missionhub.api.filters","missionhub.api.utils"])}(),function(){"use strict";function e(e,n,t){function r(n,r){return t.parent(e.getCurrentPath()).search("people",n,r)}function i(n){return t.parent(e.getCurrentPath()).get("people",n)}function a(n){return t.parent(e.getCurrentPath()).save("people",n)}var u={all:r,get:i,save:a};return u}angular.module("missionhub.api").factory("people",e),e.$inject=["organizations","userDetails","datastore"]}(),function(){"use strict";function e(e,n){function t(){return["organizations",n.getCurrentOrganization().id]}function r(){return o.allRestangular().getList()}function i(){return o.currentRestangular().get()}function a(){return e.all("organizations")}function u(){return e.one(t())}var o={all:r,current:i,allRestangular:a,currentRestangular:u,getCurrentPath:t};return o}angular.module("missionhub.api").factory("organizations",e),e.$inject=["Restangular","userDetails"]}(),function(){"use strict";function e(e,n,t,r){function i(){return r.all().then(function(e){return t.map(e,function(e){return{name:e.full_name}})})}function a(){return n(function(e){e([{name:"To retrieve from server"}])})}function u(){return n(function(e){e([{name:"To retrieve from server"}])})}function o(){return n(function(e){e([{id:"uncontacted",name:"Uncontacted"},{id:"attempted_contact",name:"Attempted Contact"},{id:"contacted",name:"Contacted"},{id:"completed",name:"Completed"},{id:"do_not_contact",name:"Do Not Contact"}])})}function s(){return n(function(e){e([{id:"admin",name:"Admin"},{id:"user",name:"User"},{id:"guest",name:"Guest"},{id:"none",name:"None"}])})}function c(){return n(function(e){e([{id:"male",name:"Male"},{id:"female",name:"Female"}])})}function l(){return n(function(e){e([{id:"yes",name:"Yes"},{id:"no",name:"No"}])})}function f(){return n(function(e){e([{name:"Survey 1"},{name:"Survey 2"}])})}function p(e){return n(function(n){n([{name:"Question 1 - "+e},{name:"Question 1 - "+e}])})}function d(e,t){return n(function(n){n([{name:"Answer 1 - "+e+" - "+t},{name:"Answer 1 - "+e+" - "+t}])})}var m={assignedTo:i,initiators:i,interactions:a,groups:u,status:o,permissions:s,gender:c,faculty:l,surveys:f,questions:p,answers:d};return m}angular.module("missionhub.api").factory("filters",e),e.$inject=["Restangular","$q","_","people"]}(),function(){"use strict";angular.module("missionhub.api.filters",[])}(),function(){"use strict";function e(){return function(e){if(!e)return"";var n=e.toString().trim().replace(/^\+/,"");if(n.match(/[^0-9]/))return e;var t,r,i;switch(n.length){case 10:t=1,r=n.slice(0,3),i=n.slice(3);break;case 11:t=n[0],r=n.slice(1,4),i=n.slice(4);break;case 12:t=n.slice(0,3),r=n.slice(3,5),i=n.slice(5);break;default:return e}return 1===t&&(t=""),i=i.slice(0,3)+"-"+i.slice(3),(t+" ("+r+") "+i).trim()}}angular.module("missionhub.api.filters").filter("tel",e)}(),function(){"use strict";function e(e,n){return function(t){if(!t)return"";var r=e.currentOrg(),i=n.find(r.surveys,{id:t.survey_id});return n.result(i,"title","")}}angular.module("missionhub.api.filters").filter("surveyName",e),e.$inject=["api","lodash"]}(),function(){"use strict";function e(){return function(e){if(!e||!e.phone_numbers||0===e.phone_numbers.length)return"";for(var n=0;n<e.phone_numbers.length;){if(e.phone_numbers[n].primary)return e.phone_numbers[n].number;n++}return e.phone_numbers[0].number}}angular.module("missionhub.api.filters").filter("personPrimaryPhone",e)}(),function(){"use strict";function e(){return function(e){return e&&e.first_name?e.first_name+" "+e.last_name:""}}angular.module("missionhub.api.filters").filter("personFullname",e)}(),function(){"use strict";function e(){return function(e,n){if(n=n||40,!e||!e.first_name)return"";if(e.picture)return e.picture+"?width="+n+"&height="+n;for(var t="444444",r=0,i=0;r<e.first_name.length;i=e.first_name.charCodeAt(r++)+((i<<5)-i));for(var r=0,t="";3>r;t+=("00"+(i>>8*r++&255).toString(16)).slice(-2));return"https://avatars.discourse.org/letter/"+e.first_name.slice(0,1)+"/"+t+"/"+n+".png"}}angular.module("missionhub.api.filters").filter("personAvatar",e)}(),function(){"use strict";function e(){return function(e){return e?e.initiators[0]?e.initiators[0]:e.creator?e.creator:{}:{}}}angular.module("missionhub.api.filters").filter("interactionPrimaryInitiator",e)}(),function(){"use strict";function e(){return function(e){var n="http://maps.google.com/maps?q=";return e.address1&&(n+=e.address1+"+"),e.address2&&(n+=e.address2+"+"),e.city&&(n+=e.city+",+"),e.state&&(n+=e.state+"+"),e.country&&(n+=e.country),n.lastIndexOf("+")===n.length-1&&(n=n.slice(0,-1)),n}}angular.module("missionhub.api.filters").filter("googleMapsAddress",e)}(),function(){"use strict";function e(){return function(e){return"background-image: url("+e+")"}}angular.module("missionhub.api.filters").filter("backgroundStyle",e)}(),function(){"use strict";angular.module("missionhub.api.cache",[])}(),function(){"use strict";function e(){function e(e){return e.id?(n[e.id]=n[e.id]||{},angular.merge(n[e.id],e),!0):n[e]}var n={};return{person:e}}angular.module("missionhub.api.cache").factory("personCache",e)}(),function(){"use strict";function e(){function e(e){return e.id?(n[e.id]=n[e.id]||{},angular.merge(n[e.id],e),!0):n[e]}var n={};return{organization:e}}angular.module("missionhub.api.cache").factory("organizationCache",e)}(),function(){"use strict";function e(){function e(e){return e&&e.length?0===e.length?0===n.length:(n=[],angular.merge(n,e),!0):angular.extend([],n)}var n=[];return{list:e}}angular.module("missionhub.api.cache").factory("organizationListCache",e)}(),function(){"use strict";angular.module("missionhub.api.config",[])}(),function(){"use strict";angular.module("missionhub.api.config").constant("apiConfig",{baseUrl:"/"})}(),function(){"use strict";function e(e,n,t){function r(e,n,t,r,a){function u(){e.addResponseInterceptor(function(e,t,r,i){return n.deserialize(e,i)}),e.addRequestInterceptor(function(e,t){return"post"===t||"patch"===t?n.serialize(e):e})}var o={baseUrl:i.baseUrl,people:{all:t.all,current:t.current,get:t.get,save:t.save},organizations:{all:r.all,current:r.current},filters:{possibilities:{assignedTo:a.assignedTo,initiators:a.initiators,interactions:a.interactions,groups:a.groups,status:a.status,permissions:a.permissions,gender:a.gender,faculty:a.faculty,surveys:a.surveys,questions:a.questions,answers:a.answers}}};return u(),o}var i={$get:r};return Object.defineProperties(i,{baseUrl:{get:function(){return e.baseUrl},set:function(r){e.baseUrl=t.parse(r),n.setBaseUrl(r)}}}),r.$inject=["Restangular","jsonapi","people","organizations","filters"],i}angular.module("missionhub.api").provider("api",e),e.$inject=["apiConfig","RestangularProvider","pathUtilsProvider"]}(),function(){"use strict";angular.module("missionhub.api").constant("_",window._)}(),function(){"use strict";function e(e){e.setPrefix("mh.user")}angular.module("missionhub.api").config(e),e.$inject=["localStorageServiceProvider"]}();