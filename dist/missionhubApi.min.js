!function(){"use strict";angular.module("missionhub.api.utils",["LocalStorageModule","change-case","lokijs","rx","restangular","missionhub.api.config"])}(),function(){"use strict";angular.module("missionhub.api.utils").constant("_",window._).constant("deepDiff",window.DeepDiff).constant("LokiIndexedAdapter",window.LokiIndexedAdapter)}(),function(){"use strict";function n(n){function e(){return n.get("firstName")}function t(e){return n.set("firstName",e)}function r(){return n.get("lastName")}function i(e){return n.set("lastName",e)}function a(){return n.get("personId")}function u(e){return n.set("personId",e)}function o(){return n.get("profilePicture")}function s(e){return n.set("profilePicture",e)}function c(){return n.get("currentOrganization")}function l(e){return n.set("currentOrganization",e)}function f(){n.clearAll()}var p={getFirstName:e,setFirstName:t,getLastName:r,setLastName:i,getPersonId:a,setPersonId:u,getProfilePicture:o,setProfilePicture:s,getCurrentOrganization:c,setCurrentOrganization:l,clearAll:f};return p}angular.module("missionhub.api.utils").factory("userDetails",n),n.$inject=["localStorageService"]}(),function(){"use strict";function n(n){var i={$get:e,parse:t,concat:r};return i}function e(n){var e={parse:t,concat:r};return e}function t(n){if(_.isArray(n)&&(n=_.join(n,"/")),_.isString(n))return _.replace(n,"/(^/)|(/$)/g","");throw new Error("Path is not a string or array")}function r(n){return _.join(_.compact(n),"/")}angular.module("missionhub.api.utils").provider("pathUtils",n),n.$inject=["_"],e.$inject=["_"]}(),function(){"use strict";function n(n,e,t,r){function i(){var n=new t("missionhub-loki");f=new e("missionhub",{autosave:!0,autosaveInterval:1e3,adapter:n}),a()}function a(){return g?r.Observable.just(f):p?p:p=r.Observable.create(function(n){f.loadDatabase({},function(){g=!0,n.onNext(f),n.onCompleted()})})}function u(n){return m[n]?r.Observable.just(m[n]):a().map(function(){var e=f.getCollection(n);return null===e&&(e=f.addCollection(n),e.ensureUniqueIndex("id")),m[n]=e,e})}function o(n,e){return u(n).map(function(n){return n.by("id",e)})}function s(n,e,t){return u(n).map(function(n){var r=n.chain();return e&&(r=r.find(e)),t&&(r=r.simplesort(t.property,t.descending)),r.data()})}function c(n,e){return l(n,e)}function l(e,t){return u(e).map(function(e){var r,i=e.by("id",t.id);return i?(i=n.merge(i,t),r=e.update(i)):r=e.insert(t),r})}var f,p,d={get:o,search:s,save:c},g=!1,m=[];return i(),d}angular.module("missionhub.api.utils").factory("lokiDB",n),n.$inject=["_","Loki","LokiIndexedAdapter","rx"]}(),function(){"use strict";function n(n,e,t){function r(e,t){l=t;var r=a(e.included);return n.isArray(e.data)?n(e.data).map(function(n){return u(n,r)}).value():u(e.data,r)}function i(e){var t={id:e.id,type:e.typeJsonapi};return t.attributes=n(e).omit("id","typeJsonapi").mapKeys(function(n,e){return c(e)}).value(),{data:t}}function a(e){return n(e).groupBy(function(n){return n.type}).mapValues(function(e){return n(e).mapKeys(function(n){return n.id}).mapValues(u).value()}).value()}function u(e,t){var r={};r.id=e.id,r.typeJsonapi=s(e.type);var i=n.mapKeys(e.attributes,function(n,e){return s(e)});if(r=n.merge(r,i),n.isObject(t)&&!n.isEmpty(t)){var a=n.mapKeys(e.relationships,function(n,e){return s(e)}),u=o(a,t);r=n.merge(r,u)}return r}function o(t,r){return n(t).mapValues(function(t){return n(t.data).map(function(n){return void 0===r[n.type]||void 0===r[n.type][n.id]?void e.error("Deserializing response from",l+": Could not load data for relationship of type",n.type,"and id",n.id):r[n.type][n.id]}).value()}).value()}function s(n){return t.camelCase(n)}function c(n){return t.snakeCase(n).replace(/(_)(\d)/g,"$2")}var l,f={deserialize:r,serialize:i,_indexIncludes:a,_flattenData:u,_findRelationships:o,_snakeToCamelCase:s,_camelToSnakeCase:c};return f}angular.module("missionhub.api.utils").factory("jsonapi",n),n.$inject=["_","$log","changeCase"]}(),function(){"use strict";function n(n,e,t,r,i,a,u,o,s){function c(n){return t.create(this,{parentPath:r.concat([this.parentPath,r.parse(n)])})}function l(){return u.oneUrl("parentPath",this.getParentPath())}function f(){return r.concat([_,this.parentPath])}function p(n,e){var r,i=e,a=[];if(t.forEachRight(e,function(u,o){var s=t.slice(e,0,o+1),c=t.get(n,s);c&&void 0!==c.id&&void 0!==c.typeJsonapi&&(r||(r=c,i=t.slice(e,o+1)),a.unshift(c.id),a.unshift(c.typeJsonapi))}),r||(r=n),void 0===n.id||void 0===n.typeJsonapi)throw new Error("No object containing an id and typeJsonapi was found");return a.unshift(n.id),a.unshift(n.typeJsonapi),{object:r,changesPath:i,resourcePath:a}}function d(n,r,i){var u,c=this,l=!0;t.set(n,r,{});var f=o(n,r,!0).filter(function(e){return e.oldValue===e.newValue||e.newValue.skipNextChangeDetection?(t.unset(n,r+".skipNextChangeDetection"),!1):!0}).tap(function(n){u=n.newValue}).map(function(n){return s.diff(n.oldValue,n.newValue,function(n,e){return"$"===e[0]||t.includes(["meta","interactions","messages","skipNextChangeDetection"],e)})}).filter(function(n){return void 0!==n}).flatMap(function(n){return a.Observable.from(n)}).publish(),d=f.window(f.debounce(500)).flatMap(function(n){return n.reduce(function(n,r){switch(r.kind){case"N":e.warning("Handling new change type as an edit",r);case"E":var i=p(u,r.path),a=t.join(i.resourcePath,"/");n[a]=n[a]||{id:i.object.id,typeJsonapi:i.object.typeJsonapi},t.set(n[a],i.changesPath,r.rhs);break;case"D":e.error("Change type not handled",r);break;case"A":e.error("Array change type not handled",r);break;default:e.error("Unknown change type",r)}return n},{}).filter(function(n){return!t.isEmpty(n)}).flatMap(function(n){return c.saveAll(n,u.typeJsonapi,u.id).observable})});return f.connect(),t.create(this,{observable:this.observable.merge(d).safeApply(n,function(e){l&&void 0!==e&&(console.log("%cInitializing cache to scope","color: purple",e),t.set(n,r,e),e.skipNextChangeDetection=!0,l=!1)})})}function g(n,e){return t.create(this,{observable:i.get(n,e).concat(this.getFromApiOnly(n,e).observable)})}function m(n,e){return t.create(this,{observable:a.Observable.fromPromise(this.currentRestangular().one(n,e).get()).flatMap(function(n){return y(n)})})}function h(n,e,r){var u=a.Observable.fromPromise(this.currentRestangular().all(n).getList()).tap(function(n){console.log("tap",n)}).flatMap(function(n){return console.log("flatMap",n),y(n)}).toArray();return t.create(this,{observable:i.search(n,e,r).concat(u.flatMap(function(){return i.search(n,e,r)}))})}function b(n,e,r){var i=this;return t.create(this,{observable:a.Observable.pairs(n).flatMap(function(n){return i.save(n[0],n[1]).observable}).count(function(){return!0}).flatMap(function(n){return console.log("%cSAVED","color: green; font-weight: bold",n,"resources"),i.getFromApiOnly(e,r).observable})})}function v(n,e){var i=this;return t.create(this,{observable:a.Observable.fromPromise(u.oneUrl("resourcePath",r.concat([i.getParentPath(),n])).patch(e)).flatMap(function(t){return console.log("%cSaving","color: green; font-weight: bold",n,e,"Response",t),y(t)})})}function y(n){return n=n.plain(),n.skipNextChangeDetection=!0,i.save(n.typeJsonapi,n)}var _=n.baseUrl,P={get:g,getFromApiOnly:m,search:h,save:v,saveAll:b,parent:c,getParentPath:f,bind:d,currentRestangular:l,_findParentResourceOfChange:p};return P}angular.module("missionhub.api.utils").factory("datastore",n),n.$inject=["apiConfig","$log","_","pathUtils","lokiDB","rx","Restangular","observeOnScope","deepDiff"]}(),function(){"use strict";angular.module("missionhub.api.filters",[])}(),function(){"use strict";function n(){return function(n){if(!n)return"";var e=n.toString().trim().replace(/^\+/,"");if(e.match(/[^0-9]/))return n;var t,r,i;switch(e.length){case 10:t=1,r=e.slice(0,3),i=e.slice(3);break;case 11:t=e[0],r=e.slice(1,4),i=e.slice(4);break;case 12:t=e.slice(0,3),r=e.slice(3,5),i=e.slice(5);break;default:return n}return 1===t&&(t=""),i=i.slice(0,3)+"-"+i.slice(3),(t+" ("+r+") "+i).trim()}}angular.module("missionhub.api.filters").filter("tel",n)}(),function(){"use strict";function n(n,e){return function(t){if(!t)return"";var r=n.currentOrg(),i=e.find(r.surveys,{id:t.survey_id});return e.result(i,"title","")}}angular.module("missionhub.api.filters").filter("surveyName",n),n.$inject=["api","lodash"]}(),function(){"use strict";function n(){return function(n){if(!n||!n.phone_numbers||0===n.phone_numbers.length)return"";for(var e=0;e<n.phone_numbers.length;){if(n.phone_numbers[e].primary)return n.phone_numbers[e].number;e++}return n.phone_numbers[0].number}}angular.module("missionhub.api.filters").filter("personPrimaryPhone",n)}(),function(){"use strict";function n(){return function(n){return n&&n.first_name?n.first_name+" "+n.last_name:""}}angular.module("missionhub.api.filters").filter("personFullname",n)}(),function(){"use strict";function n(){return function(n,e){if(e=e||40,!n||!n.first_name)return"";if(n.picture)return n.picture+"?width="+e+"&height="+e;for(var t="444444",r=0,i=0;r<n.first_name.length;i=n.first_name.charCodeAt(r++)+((i<<5)-i));for(var r=0,t="";3>r;t+=("00"+(i>>8*r++&255).toString(16)).slice(-2));return"https://avatars.discourse.org/letter/"+n.first_name.slice(0,1)+"/"+t+"/"+e+".png"}}angular.module("missionhub.api.filters").filter("personAvatar",n)}(),function(){"use strict";function n(){return function(n){return n?n.initiators[0]?n.initiators[0]:n.creator?n.creator:{}:{}}}angular.module("missionhub.api.filters").filter("interactionPrimaryInitiator",n)}(),function(){"use strict";function n(){return function(n){var e="http://maps.google.com/maps?q=";return n.address1&&(e+=n.address1+"+"),n.address2&&(e+=n.address2+"+"),n.city&&(e+=n.city+",+"),n.state&&(e+=n.state+"+"),n.country&&(e+=n.country),e.lastIndexOf("+")===e.length-1&&(e=e.slice(0,-1)),e}}angular.module("missionhub.api.filters").filter("googleMapsAddress",n)}(),function(){"use strict";function n(){return function(n){return"background-image: url("+n+")"}}angular.module("missionhub.api.filters").filter("backgroundStyle",n)}(),function(){"use strict";angular.module("missionhub.api",["restangular","missionhub.api.config","missionhub.api.cache","missionhub.api.filters","missionhub.api.utils"])}(),function(){"use strict";function n(n,e,t){function r(e,r){return t.parent(n.getCurrentPath()).search("people",e,r)}function i(e){return t.parent(n.getCurrentPath()).get("people",e)}function a(e){return t.parent(n.getCurrentPath()).save("people",e)}var u={all:r,get:i,save:a};return u}angular.module("missionhub.api").factory("people",n),n.$inject=["organizations","userDetails","datastore"]}(),function(){"use strict";function n(n,e){function t(){return["organizations",e.getCurrentOrganization().id]}function r(){return o.allRestangular().getList()}function i(){return o.currentRestangular().get()}function a(){return n.all("organizations")}function u(){return n.one(t())}var o={all:r,current:i,allRestangular:a,currentRestangular:u,getCurrentPath:t};return o}angular.module("missionhub.api").factory("organizations",n),n.$inject=["Restangular","userDetails"]}(),function(){"use strict";function n(n,e,t,r){function i(){return r.all().then(function(n){return t.map(n,function(n){return{name:n.full_name}})})}function a(){return e(function(n){n([{name:"To retrieve from server"}])})}function u(){return e(function(n){n([{name:"To retrieve from server"}])})}function o(){return e(function(n){n([{id:"uncontacted",name:"Uncontacted"},{id:"attempted_contact",name:"Attempted Contact"},{id:"contacted",name:"Contacted"},{id:"completed",name:"Completed"},{id:"do_not_contact",name:"Do Not Contact"}])})}function s(){return e(function(n){n([{id:"admin",name:"Admin"},{id:"user",name:"User"},{id:"guest",name:"Guest"},{id:"none",name:"None"}])})}function c(){return e(function(n){n([{id:"male",name:"Male"},{id:"female",name:"Female"}])})}function l(){return e(function(n){n([{id:"yes",name:"Yes"},{id:"no",name:"No"}])})}function f(){return e(function(n){n([{name:"Survey 1"},{name:"Survey 2"}])})}function p(n){return e(function(e){e([{name:"Question 1 - "+n},{name:"Question 1 - "+n}])})}function d(n,t){return e(function(e){e([{name:"Answer 1 - "+n+" - "+t},{name:"Answer 1 - "+n+" - "+t}])})}var g={assignedTo:i,initiators:i,interactions:a,groups:u,status:o,permissions:s,gender:c,faculty:l,surveys:f,questions:p,answers:d};return g}angular.module("missionhub.api").factory("filters",n),n.$inject=["Restangular","$q","_","people"]}(),function(){"use strict";angular.module("missionhub.api.config",[])}(),function(){"use strict";angular.module("missionhub.api.config").constant("apiConfig",{baseUrl:"/"})}(),function(){"use strict";angular.module("missionhub.api.cache",[])}(),function(){"use strict";function n(){function n(n){return n.id?(e[n.id]=e[n.id]||{},angular.merge(e[n.id],n),!0):e[n]}var e={};return{person:n}}angular.module("missionhub.api.cache").factory("personCache",n)}(),function(){"use strict";function n(){function n(n){return n.id?(e[n.id]=e[n.id]||{},angular.merge(e[n.id],n),!0):e[n]}var e={};return{organization:n}}angular.module("missionhub.api.cache").factory("organizationCache",n)}(),function(){"use strict";function n(){function n(n){return n&&n.length?0===n.length?0===e.length:(e=[],angular.merge(e,n),!0):angular.extend([],e)}var e=[];return{list:n}}angular.module("missionhub.api.cache").factory("organizationListCache",n)}(),function(){"use strict";function n(n,e,t){function r(n,e,t,r,a){function u(){n.addResponseInterceptor(function(n,t,r,i){return e.deserialize(n,i)}),n.addRequestInterceptor(function(n,t){return"patch"===t?e.serialize(n):n})}var o={baseUrl:i.baseUrl,people:{all:t.all,current:t.current,get:t.get,save:t.save},organizations:{all:r.all,current:r.current},filters:{possibilities:{assignedTo:a.assignedTo,initiators:a.initiators,interactions:a.interactions,groups:a.groups,status:a.status,permissions:a.permissions,gender:a.gender,faculty:a.faculty,surveys:a.surveys,questions:a.questions,answers:a.answers}}};return u(),o}var i={$get:r};return Object.defineProperties(i,{baseUrl:{get:function(){return n.baseUrl},set:function(r){n.baseUrl=t.parse(r),e.setBaseUrl(r)}}}),r.$inject=["Restangular","jsonapi","people","organizations","filters"],i}angular.module("missionhub.api").provider("api",n),n.$inject=["apiConfig","RestangularProvider","pathUtilsProvider"]}(),function(){"use strict";angular.module("missionhub.api").constant("_",window._)}(),function(){"use strict";function n(n){n.setPrefix("mh.user")}angular.module("missionhub.api").config(n),n.$inject=["localStorageServiceProvider"]}();